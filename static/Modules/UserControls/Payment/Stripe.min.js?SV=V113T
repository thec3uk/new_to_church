var InsightStripe=function(n){var a=function(t){var r=n(EndisForm()),i;t.error?(n(".payment-errors").text(t.error.message).show(),r.keydown(function(){n(".payment-errors").hide()}),n(".submit-btn").prop("disabled",!1)):(n('[id$="hdnNewCardToken"]').val(t.token.id),n('[id$="hdnNewCardBrand"]').val(t.token.card.brand.replace(" ","-").toLowerCase()),n('[id$="hdnNewCardFriendlyName"]').val(n('[data-stripe="friendly-name"]').val()),typeof ProcessNewCardOnClient=="function"?(c(),ProcessNewCardOnClient(),this.elSubmit&&(i=this.elSubmit,this.elSubmit=null,n(i).click())):(n(".new-card-details").slideUp(),u(),typeof PostbackWithoutWarning=="function"?PostbackWithoutWarning("AddCard"):__doPostBack("AddCard")))},r,t,i,h=function(){var t=w();t=b()&&t;t&&(n(".submit-btn").prop("disabled",!0),stripe.createToken(r,{name:n('input[data-stripe="name"]').val(),address_zip:n('input[data-stripe="address_zip"]').val()}).then(function(n){a(n)}))},u=function(){n("div.stripe-loading-overlay").show()},v=function(){return n("li.existing-card input:radio:checked").length>0||n('[id$="hdnNewCardToken"]').val()},c=function(){n(".new-card-details").slideUp();n("div.buttonbar").show();n(".brand-image.new-card").attr("class","brand-image new-card card-type-"+n('[id$="hdnNewCardBrand"]').val());n(".brand-image.new-card").html(n('[id$="hdnNewCardFriendlyName"]').val());n('.new-card-radio-hidden input[type="radio"]').prop("checked","true").hide();n(".new-card-radio-hidden").removeClass("new-card-radio-hidden");n(".add-new-card").off("click")},y=function(n){confirm("Are you sure you want to delete this card?")&&(u(),typeof PostbackWithoutWarning=="function"?PostbackWithoutWarning("DeleteCard",n):__doPostBack("DeleteCard",n))},p=function(){var e,f,c,o,a,s,h,v,u;if(n(".add-new-card").click(function(){l(!0);n(".new-card-details").slideDown(400,function(){n("div.buttonbar").hide();n('[data-stripe="friendly-name"]').focus()})}),n(".existing-card").click(function(){n(".new-card-details").slideUp();n("div.buttonbar").show()}),n('.new-card input[type="radio"]').is(":checked")&&!n('[id$="hdnNewCardToken"]').val()&&n(".new-card-details").show(),n('.new-card-radio-hidden input[type="radio"]').prop("checked","true"),f={},c=n(".new-card-panel").closest(".manual-element-styling").length===0,typeof StripeElementStyles!="undefined")f.style=StripeElementStyles;else if(typeof c!="undefined"&&c){for(o=0;o<document.styleSheets.length;o++){a=document.styleSheets[o];try{for(s=0;s<a.rules.length;s++)if(h=a.rules[s],h.type==3&&h.href.indexOf("font")>-1){e=h.href;break}}catch(nt){}if(e)break}v=!0;n(".new-card-details").is(":visible")||(v=!1,n(".new-card-details").show());u=n('input[data-stripe="name"]');n(".element-container").css({border:u.css("border"),"background-color":u.css("background-color"),"border-radius":u.css("border-radius"),margin:u.css("margin"),padding:u.css("padding"),"letter-spacing":u.css("letter-spacing"),"-webkit-appearance":u.css("-webkit-appearance"),height:u.css("height")});var k=n('<div class="form-row"><label><input type="text" size="20" maxlength="19" data-stripe="number" /><\/label><\/div>').appendTo("div.new-card-panel"),d=n('<div class="form-row"><label><input type="text" size="6" data-stripe="exp" /><\/label><\/div>').appendTo("div.new-card-panel"),g=n('<div class="form-row"><label><input type="text" size="5" maxlength="5" data-stripe="cvc" /><\/label><\/div>').appendTo("div.new-card-panel");n("#divCardNumberElement").css("width",k.find("input").outerWidth()+40);n("#divCardExpiryElement").css("width",d.find("input").outerWidth());n("#divCardCVCElement").css("width",g.find("input").outerWidth());f.style={base:{}};f.style.base.fontFamily=u.css("font-family");f.style.base.fontSize=u.css("font-size");f.style.base.color=u.css("color");v||n(".new-card-details").hide();k.remove();d.remove();g.remove()}var y=stripe.elements(e?{fonts:[{cssSrc:e}]}:null),p=!1,w=!1,b=n.extend(!0,{},f);b.placeholder="";r=y.create("cardNumber",b);r.mount("#divCardNumberElement");r.on("change",function(i){i.error?n(".validate-number").text(i.error.message).show():(n(".validate-number").hide(),n("#divCardNumberElement").removeClass(function(n,t){return(t.match(/(^|\s)card-type\S*/g)||[]).join(" ")}),i.brand&&i.brand!=="unknown"&&n("#divCardNumberElement").addClass("card-type card-type-"+i.brand),i.complete&&(t.focus(),p=!0,setTimeout(function(){p=!1},1e3)))});t=y.create("cardExpiry",f);t.mount("#divCardExpiryElement");t.on("change",function(t){t.error?n(".validate-exp").text(t.error.message).show():(n(".validate-exp").hide(),t.complete&&(i.focus(),w=!0,setTimeout(function(){w=!1},1e3)))});t.on("blur",function(){p&&t.focus()});i=y.create("cardCvc",b);i.mount("#divCardCVCElement");i.on("change",function(t){t.error?n(".validate-cvc").text(t.error.message).show():n(".validate-cvc").hide()});i.on("blur",function(){w&&i.focus()})},f=!0,l=function(t){f=!1;t&&(n(".input-invalid").removeClass("input-invalid"),n(".validator").hide());setTimeout(function(){f=!0},1e3)},e=function(t,i){var u=n('[data-stripe="'+t+'"]'),e=n(".validate-"+t),r=typeof i!="function"||i(u.val());return setTimeout(function(){f&&(u.toggleClass("input-invalid",!r),e.toggle(!r))},100),r},o=function(n){return typeof n!="undefined"&&n.trim()!=""},w=function(){return e("friendly-name",o)},b=function(){return e("name",o)},k=function(t){n('[data-stripe="'+t+'"]').removeClass("input-invalid");n(".validate-"+t).hide()},d=function(){var t=n(".stripe-card-list input:radio:checked").parent().find("input.last-4:text");t.show();typeof PreventLast4Focus=="function"&&PreventLast4Focus()||t.focus();n(".stripe-card-list input:radio").change(function(){n("input.last-4:text").hide();n(this).parent().find("input.last-4:text").show().focus()})},s=function(t){var i=n('[data-stripe="'+t+'"]');i.blur(function(){e(t,o)});i.keydown(function(){k(t)})},g=function(){n(".ui-tooltipped").uitooltip({disabled:!0,position:{my:"center top",at:"center bottom+10"},tooltipClass:"stripe-tooltip",hide:{duration:2e3},close:function(){n(".ui-tooltipped").uitooltip("disable")}}).click(function(){l(!1);n(this).uitooltip("enable").uitooltip("open")})},nt=function(){n('[data-stripe="address_zip"]').val()||n('[data-stripe="address_zip"]').val(n('[id$="hdnDefaultPostcode"]').val());s("address_zip")},tt=this;n(document).on("PGRegConfirm:PreSubmitValidate",function(t,i,r){n(".new-card-details").is(":visible")&&(tt.elSubmit=r,i(),h())});return n(document).ready(function(){g();p();d();s("friendly-name");s("name");nt();n('[id$="hdnNewCardToken"]').val()&&c();n(".new-card-details").is(":visible")&&n("div.buttonbar").hide()}),{SubmitStripe:h,ShowOverlay:u,ShopValidateStripeSelection:v,DeleteCard:y}}($e);